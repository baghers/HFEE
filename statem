

previousst=1
uniformthresh=0.55
freqthreshold=1400

max=10
for i in `seq 1 $max`
do
	currentuniformity="$(./cluni 4 0.1 0.16 0.25 0.08)"
	CPU4_FREQ=$((`cat /sys/devices/system/cpu/cpu7/cpufreq/scaling_cur_freq`/1000))
	
	if (( $(echo "$currentuniformity < $uniformthresh" |bc -l) )) && [ $CPU4_FREQ -le $freqthreshold ] 
	then
		currentst=1
		elif (( $(echo "$currentuniformity >= $uniformthresh" |bc -l) )) && [ $CPU4_FREQ -le $freqthreshold ] && [ $previousst -lt 2 ]
		then
			currentst=2
			elif (( $(echo "$currentuniformity < $uniformthresh" |bc -l) )) && [ $CPU4_FREQ -gt $freqthreshold ]
			then
				currentst=3
				elif (( $(echo "$currentuniformity >= $uniformthresh" |bc -l) )) && [ $CPU4_FREQ -gt $freqthreshold ]
				then
					currentst=4
					elif (( $(echo "$currentuniformity >= $uniformthresh" |bc -l) )) && [ $CPU4_FREQ -le $freqthreshold ] && [ $previousst -gt 2 ]
					then
						currentst=5
			
	fi
	CPU4_FREQnew=$CPU4_FREQ
	if [ $currentst -eq 3 ] || [ $currentst -eq 4 ]
	then
		if [ $CPU4_FREQ -gt 200 ]
		then
			CPU4_FREQnew=$(( $CPU4_FREQ - 100 ))
		fi
		elif [ $currentst -eq 1 ] || [ $currentst -eq 2 ]
		then
		if [ $CPU4_FREQ -lt 2000 ]
		then
			CPU4_FREQnew=$(( $CPU4_FREQ + 100 )) 
		fi
	fi
	
	if [ $CPU4_FREQ -ne $CPU4_FREQnew ]
	then
		CPU4_FREQnew=$(( $CPU4_FREQnew * 1000 )) 
    echo userspace >/sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
    echo userspace >/sys/devices/system/cpu/cpu5/cpufreq/scaling_governor
    echo userspace >/sys/devices/system/cpu/cpu6/cpufreq/scaling_governor
    echo userspace >/sys/devices/system/cpu/cpu7/cpufreq/scaling_governor
	

	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu5/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu6/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu7/cpufreq/scaling_max_freq
	
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu5/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu6/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu7/cpufreq/scaling_min_freq

	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu5/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu6/cpufreq/scaling_max_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu7/cpufreq/scaling_max_freq
	
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu5/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu6/cpufreq/scaling_min_freq
	echo $CPU4_FREQnew >/sys/devices/system/cpu/cpu7/cpufreq/scaling_min_freq
    fi
	
	previousst=$currentst
	echo "$currentuniformity $currentst $CPU4_FREQ $CPU4_FREQnew"
    
done

